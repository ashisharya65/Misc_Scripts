# PowerShell scripts to create Event Triggered schd tasks
This repo contains the scripts which I used recently to create event triggered schd task on Intune managed VMs so as to shutdown the unused VMs and save some cost.
1. The [Create-DeviceShutdownEventTriggeredSchdTask.ps1](https://github.com/ashisharya65/My-PowerShell-Scripts/blob/main/WindowsMachines/ScheduledTask/EventTriggeredSchdTask/Create-DeviceShutdownEventTriggeredSchdTask.ps1) script will create a scheduled task named <b>DeviceShutdownEventTriggeredSchdTask</b>. This task is set up to monitor the user log-off event (Event ID - 4647). When this event is detected, the task activates a 30-minute waiting period before initiating the shutdown of the device.<br/>

2. The second [Reset-DeviceShutdownEventTriggeredSchdTask.ps1](https://github.com/ashisharya65/My-PowerShell-Scripts/blob/main/WindowsMachines/ScheduledTask/EventTriggeredSchdTask/Reset-ShutdownEventTriggeredSchdTask.ps1) script is designed to create a scheduled task named <b>Reset-DeviceShutdownEventTriggeredSchdTask</b>. This schd task involves generating a powershell script,[Reset.ps1](https://github.com/ashisharya65/My-PowerShell-Scripts/blob/main/WindowsMachines/ScheduledTask/EventTriggeredSchdTask/Reset.ps1),and placing it at the location <b>C:\Temp\ResetDeviceShutdownSchdTask</b>.
This scheduled task is also configured to execute the [Reset.ps1](https://github.com/ashisharya65/My-PowerShell-Scripts/blob/main/WindowsMachines/ScheduledTask/EventTriggeredSchdTask/Reset.ps1) powershell script, which in turn performs a reset operation (disabling and enabling) on the existing <b>DeviceShutdownEventTriggeredSchdTask</b> task on the device. This action ensures that the <b>DeviceShutdownEventTriggeredSchdTask</b> scheduled task resumes monitoring for the user log-off event.
The activation conditions for the <b>Reset-DeviceShutdownEventTriggeredSchdTask</b> task are programmed as follows:

    - The task named <b>DeviceShutdownEventTriggeredSchdTask</b> has already been executed and is presently in a waiting state, observing a 30-minute delay before initiating a device shutdown.
    - A user connect event has occurred.
